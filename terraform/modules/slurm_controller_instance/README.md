# Module: Slurm Controller Instance

This module creates a Slurm controller instance from instance template.
Additionally it will create and terminate compute instances from instance
templates based on configuration.

It is recommended to use instance templates generated by the
[slurm_instance_template](../slurm_instance_template) module.

## Usage

See the [simple controller](../../examples/slurm_controller_instance/simple)
example or the [simple cluster](../../examples/slurm_cluster/simple) example
for usage examples.

## Additional Dependencies

- [**python**](https://www.python.org/) must be installed and in `$PATH` of the
  user running `terraform apply`.
  - Required Version: `~3.6, >= 3.6.0, < 4.0.0`
- [**Secret Manager**](https://console.cloud.google.com/security/secret-manager)
  is enabled.

## Service Accounts

[Documentation](https://cloud.google.com/iam/docs/service-accounts)

### Roles

- roles/compute.instanceAdmin
- roles/iam.serviceAccountUser
- roles/logging.logWriter
- roles/monitoring.metricWriter
- roles/pubsub.publisher
- roles/pubsub.subscriber
- roles/secretmanager.secretAccessor

### Scopes

- https://www.googleapis.com/auth/cloud-platform

## Warning

This module creates compute instances that are not managed by terraform. However,
the helper script [`destroy_nodes.py`](../../../scripts/destroy_nodes.py) will
run on `terraform destroy`. This will destroy compute instances labeled with the
same `slurm_cluster_id` as the slurm controller instance. Any compute instances
that fail to be destroyed by these means must be manually terminated. Failure to
do so will result in additional cloud costs.
